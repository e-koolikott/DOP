<md-card class="portfolio-chapter card-lg" data-ng-class="$ctrl.getChapterClassNames()" id="{{slug}}">
  <!--View-->
  <md-card-content data-ng-if="!$ctrl.isEditMode">
    <h2 data-ng-if="chapter.title" data-ng-bind="chapterTitle"></h2>
    <div class="chapter-blocks">
      <div
        class="chapter-block"
        data-ng-repeat="block in chapter.blocks track by $index"
        data-ng-class="$ctrl.getBlockClassNames($index)"
        data-ng-bind-html="block.htmlContent"
      ></div>
    </div>
  </md-card-content>
  <!--Edit-->
  <md-card-content data-ng-if="$ctrl.isEditMode" data-ng-click="$ctrl.focusChapter($event)">
    <md-input-container
      class="md-block chapter-title"
      data-ng-click="$ctrl.focusTitle(true)"
      >
      <label></label>
      <input
        class="md-headline"
        placeholder="{{'PORTFOLIO_ENTER_CHAPTER_TITLE' | translate}}"
        data-ng-model="chapter.title"
        data-ng-focus="$ctrl.focusTitle()"
      >
    </md-input-container>
    <div class="chapter-blocks">
      <div
        class="chapter-block"
        data-ng-repeat="block in chapter.blocks track by $index"
        data-ng-class="$ctrl.getBlockClassNames($index)"
        data-ng-click="$ctrl.onClickBlock($index, $event)"
        data-placeholder="{{$ctrl.getBlockPlaceholder($index)}}"
      ></div>
    </div>
  </md-card-content>
  <div
    data-ng-if="$ctrl.isEditMode"
    class="chapter-toolbar"
    data-ng-click="$ctrl.onClickEmptyToolbarArea($event)"
    >
    <div class="sticky" data-ng-class="stickyClassNames" data-ng-style="stickyStyle">
      <div>
        <h5>Lisa sisu</h5>
        <!--<div class="chapter-btn chapter-btn--media" data-ng-click="$ctrl.addMedia()">
          <md-button class="md-icon-button" aria-label="Lisa meedia">
            <md-icon class="material-icons">image</md-icon>
          </md-button>
          <label>Meedia</label>
        </div>
        <div class="chapter-btn chapter-btn--preferred-material" data-ng-click="$ctrl.addRecommendedMaterial()">
          <md-button class="md-icon-button" aria-label="Lisa eelistatud materjal">
            <md-icon class="material-icons">star</md-icon>
          </md-button>
          <label>Eelistatud materjal</label>
        </div>-->
        <div class="chapter-btn chapter-btn--existing-material" data-ng-click="$ctrl.addExistingMaterial()" style="width:50%;">
          <md-button class="md-icon-button" aria-label="Lisa olemasolev materjal" style="display:block;margin:0 auto;">
            <md-icon class="material-icons">description</md-icon>
          </md-button>
          <label>Olemasolev materjal</label>
        </div>
        <div class="chapter-btn chapter-btn--new-material" data-ng-click="$ctrl.addNewMaterial()" style="width:50%;">
          <md-button class="md-icon-button" aria-label="Lisa uus materjal" style="display:block;margin:0 auto;">
            <md-icon md-svg-src="/images/chapter-toolbar-icon-new-material.svg"></md-icon>
          </md-button>
          <label>Uus materjal</label>
        </div>
      </div>
      <div>
        <h5>KÃ¼ljenda</h5>
        <div
          class="chapter-btn chapter-btn--toggle-block-width"
          data-ng-click="$ctrl.toggleBlockWidth()"
          data-ng-mousedown="$ctrl.beforeToggleBlockWidth(true)"
          >
          <md-button class="md-icon-button" aria-label="Muuda ploki laiust">
            <md-icon md-svg-src="{{$ctrl.getToggleColumnWidthIcon()}}"></md-icon>
          </md-button>
          <label>Muuda laiust</label>
        </div>
        <div
          class="chapter-btn chapter-btn--move-block-back"
          data-ng-click="$ctrl.moveBlock(true)"
          data-ng-mousedown="$ctrl.beforeMoveBlock(true)"
          data-ng-disabled="focusedBlockIdx === 0"
          >
          <md-button class="md-icon-button" aria-label="Liiguta plokki tagasi">
            <md-icon class="material-icons">arrow_back</md-icon>
          </md-button>
          <label>Liiguta tagasi</label>
        </div>
        <div
          class="chapter-btn chapter-btn--move-block-forward"
          data-ng-click="$ctrl.moveBlock()"
          data-ng-mousedown="$ctrl.beforeMoveBlock()"
          data-ng-disabled="focusedBlockIdx === chapter.blocks.length - 1"
          >
          <md-button class="md-icon-button" aria-label="Liiguta plokki edasi">
            <md-icon class="material-icons">arrow_forward</md-icon>
          </md-button>
          <label>Liiguta edasi</label>
        </div>
        <div class="chapter-btn chapter-btn--delete-block" data-ng-click="$ctrl.deleteBlock()" data-ng-disabled="chapter.blocks.length < 2">
          <md-button class="md-icon-button" aria-label="Kustuta plokk">
            <md-icon class="material-icons">delete</md-icon>
          </md-button>
          <label>Kustuta</label>
        </div>
      </div>
      <div>
        <div class="chapter-btn-large" data-ng-click="$ctrl.addBlock()">
          <md-button class="md-icon-button" aria-label="Lisa sisuplokk">
            <md-icon class="material-icons">add</md-icon>
          </md-button>
          <label>Lisa sisuplokk</label>
        </div>
      </div>
    </div>
  </div>
  <div
    data-ng-if="$ctrl.isEditMode"
    class="organize-chapters"
    data-ng-hide="$ctrl.numChapters < 2"
    >
    <md-button class="organize-chapter-btn md-icon-button" data-ng-click="$ctrl.onMoveUp()" data-ng-disabled="$ctrl.index === 0">
      <md-icon>arrow_upward</md-icon>
    </md-button>
    <md-button class="organize-chapter-btn md-icon-button" data-ng-click="$ctrl.onMoveDown()" data-ng-disabled="$ctrl.index === $ctrl.numChapters - 1">
      <md-icon>arrow_downward</md-icon>
    </md-button>
    <md-button class="organize-chapter-btn md-icon-button" data-ng-click="$ctrl.onDelete()">
      <md-icon>delete</md-icon>
    </md-button>
  </div>
  <md-button
    class="md-icon-button toggle-chapter-focus"
    data-ng-if="$ctrl.isEditMode"
    data-ng-click="$ctrl.onClickToggleChapterFocus()"
    >
    <md-icon class="material-icons">edit</md-icon>
  </md-button>

  <!-- Temp: old -->
  <!--Chapter rows-->
  <!--<ul
    data-ng-if="$ctrl.isEditMode && $ctrl.chapter.contentRows.length"
    class="portfolio-chapter-chapter-materials"
    uib-collapse="$ctrl.isCollapsed"
    >
    <li data-ng-repeat="(rowIndex, contentRow) in $ctrl.chapter.contentRows track by $index" flex>
      <ul
        data-ng-if="contentRow.learningObjects.length"
        dnd-list="contentRow.learningObjects"
        data-layout-gt-sm="row"
        >
        <li
          id="chapterMaterial-{{$ctrl.index}}-{{$index}}"
          data-ng-repeat="(columnIndex, learningObject) in contentRow.learningObjects track by $index"
          data-dop-embedded-material
          data-material="learningObject"
          data-chapter="$ctrl.chapter"
          data-row-index="rowIndex"
          data-obj-index="columnIndex"
          data-flex
        ></li>
      </ul>
    </li>
  </ul>
  <div class="portfolio-chapter-subchapters" data-ng-if="!$ctrl.isEditMode">
    <div
      class="portfolio-chapter-subchapter"
      id="chapter-{{$ctrl.index}}-{{$index}}"
      data-ng-repeat="subchapter in $ctrl.chapter.subchapters track by $index"
      >
      <md-card class="card-lg chapter-card">
        <md-card-content layout="row">
          <div flex>
            <div layout="row" class="pointer" data-ng-click="$ctrl.onClickSubChapter($index)">
              <h3>
                <span data-ng-if="subchapter.title" data-ng-bind="subchapter.title"></span>
                <span data-ng-if="!subchapter.title" data-translate="PORTFOLIO_SUBCHAPTER_TITLE_MISSING"></span>
              </h3>
              <div class="chapter-arrow" data-ng-class="{'toggled': !$ctrl.subisCollapsed[$index]}">
                <md-icon class="material-icons md-primary">keyboard_arrow_right</md-icon>
              </div>
              <md-tooltip md-direction="bottom">
                <span data-ng-if="$ctrl.subisCollapsed[$index]" data-translate="TOOLTIP_OPEN_SUBCHAPTER">Open subchapter</span>
                <span data-ng-if="!$ctrl.subisCollapsed[$index]" data-translate="TOOLTIP_CLOSE_SUBCHAPTER">Close subchapter</span>
              </md-tooltip>
            </div>
            <div uib-collapse="$ctrl.subisCollapsed[$index]">
              <p class="md-body-1 textangular-view" data-ng-class="{'hide': subchapter.text.length == undefined || subchapter.text.length == 0}"
                data-ng-bind-html="subchapter.text"></p>
            </div>
          </div>
        </md-card-content>
      </md-card>
      <ul
        data-ng-if="subchapter.contentRows.length"
        class="portfolio-chapter-subchapter-materials"
        uib-collapse="$ctrl.subisCollapsed[$index]">
        <li data-ng-repeat="(rowIndex, contentRow) in subchapter.contentRows track by $index" flex>
          <ul
            data-ng-if="contentRow.learningObjects.length"
            dnd-list="contentRow.learningObjects"
            data-layout-gt-sm="row">
            <li
              id="subChapterMaterial-{{$ctrl.index}}-{{$index}}"
              data-ng-repeat="(columnIndex, learningObject) in contentRow.learningObjects track by $index"
              data-dop-embedded-material
              data-material="learningObject"
              data-chapter="subchapter"
              data-row-index="rowIndex"
              data-obj-index="columnIndex"
              data-flex
            ></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>-->
</md-card>
